#!/bin/bash

#Unfinished version of bash script (bn)

#local usage function
usage(){
    echo "bn <year> <assigned gender f|F|m|M|b|B>"
    exit 1
}

#local help function
help(){
    echo "output help messages ..."
    exit 0
}

birthYear=$1
birthGender=$2
dataFile="us_baby_names/yob${birthYear}.txt"

if [[ $# -gt 2 || $# -lt 2 ]]
then
    usage
fi

if [[ $birthYear =~ ^[0-9]{4}$ ]] 
then
    true
else
    echo "Badly formatted year: $birthYear"
    usage
fi

if [[ $birthGender =~ ^[FfMmBb]$ ]] 
then
    true
else
    echo "Badly formatted assigned gender: $birthGender"
    usage
fi


if [[ -f $dataFile ]]
then
    true
else
    usage
fi

#add gender categorization
#add both gender option
#finish rank function
rank(){
    local name=$1
    if [[ $name =~ ^[A-Za-z]+ ]]
    then
        echo "$birthYear: $name ranked $(cat $dataFile | grep -P -i "^[A-Z]+,$birthGender,[0-9]+" | grep -n -P -i -w "$name,[mMfFbB],[0-9]+" | grep -P -o "^[0-9]+") out of $(cat $dataFile | grep -P -i "^[A-Z]+,$birthGender,[0-9]+" | wc -l) names."
    else
        echo "Badly formatted name: $name"
    fi
}

while read line
do
    for allNames in $line
    do
        rank $allNames
    done
done